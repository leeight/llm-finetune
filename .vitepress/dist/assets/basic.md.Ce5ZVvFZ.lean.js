import{_ as Q,c as n,o as l,ag as i,j as s,a as t}from"./chunks/framework.C1nslR49.js";const e="/llm-finetune/assets/transformers.B4fGFxRx.png",T="/llm-finetune/assets/bpe.DGdLq8OY.png",h="/llm-finetune/assets/input_x.y-y6pLY-.png",p="/llm-finetune/assets/attention.BrL18YE_.png",d="/llm-finetune/assets/dot_product.CxAa6zfS.png",k="/llm-finetune/assets/cos.ByJdl-dr.png",r="/llm-finetune/assets/multi_head.NtQ2u1gT.png",o="/llm-finetune/assets/RoPE.CDIGkZVt.png",m="/llm-finetune/assets/softmax.DAcsKncP.png",g="/llm-finetune/assets/llama.p-81TNyi.png",E="/llm-finetune/assets/silu.B2SKFQ2P.png",y="/llm-finetune/assets/before_normalization.ev2lqQd6.png",c="/llm-finetune/assets/vscode_debug.ChWO-RrT.png",u="/llm-finetune/assets/vscode_debug_set_breakpoint.B-zCyqVc.png",F="/llm-finetune/assets/torchtune_profiler.DZoyf4WV.png",H="/llm-finetune/assets/switch_transformer_large.BvIBgzmi.png",x="/llm-finetune/assets/falconmamba-performance.DpY7awGS.png",w="/llm-finetune/assets/falconmamba-memory.BnBNvnCF.png",L="/llm-finetune/assets/ViT.CC0jbFe5.png",C="/llm-finetune/assets/llama3_architecture.5zQcy1fR.png",f="/llm-finetune/assets/cross_attention.DXRA1UaK.png",D="/llm-finetune/assets/qwen2_vl_frame.C4YCSatC.jpg",M="/llm-finetune/assets/Qwen2_vl_param.Bj5n8nmX.png",n2=JSON.parse('{"title":"大模型基础","description":"","frontmatter":{},"headers":[],"relativePath":"basic.md","filePath":"basic.md"}'),b={name:"basic.md"},V={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},A={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.589ex",height:"2.195ex",role:"img",focusable:"false",viewBox:"0 -683 1586.3 970.2","aria-hidden":"true"},_={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},B={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.746ex",height:"1.885ex",role:"img",focusable:"false",viewBox:"0 -683 1655.6 833","aria-hidden":"true"},Z={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},v={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.375ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.554ex",height:"1.92ex",role:"img",focusable:"false",viewBox:"0 -683 1570.8 848.6","aria-hidden":"true"},j={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},R={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"35.9ex",height:"2.242ex",role:"img",focusable:"false",viewBox:"0 -704 15867.7 991.2","aria-hidden":"true"},q={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.308ex"},xmlns:"http://www.w3.org/2000/svg",width:"42.496ex",height:"5.741ex",role:"img",focusable:"false",viewBox:"0 -1517.7 18783.4 2537.7","aria-hidden":"true"},O={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},P={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.859ex"},xmlns:"http://www.w3.org/2000/svg",width:"52.3ex",height:"8.85ex",role:"img",focusable:"false",viewBox:"0 -2205.8 23116.7 3911.5","aria-hidden":"true"},N={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"28.985ex",height:"2.009ex",role:"img",focusable:"false",viewBox:"0 -694 12811.2 888","aria-hidden":"true"},I={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},X={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.041ex",height:"1.439ex",role:"img",focusable:"false",viewBox:"0 -442 460 636","aria-hidden":"true"},G={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},K={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.179ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 521 705","aria-hidden":"true"},J={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},U={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.041ex",height:"1.439ex",role:"img",focusable:"false",viewBox:"0 -442 460 636","aria-hidden":"true"},W={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Y={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.179ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 521 705","aria-hidden":"true"},$={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},s1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.179ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 521 705","aria-hidden":"true"},a1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},t1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.564ex"},xmlns:"http://www.w3.org/2000/svg",width:"16.449ex",height:"2.26ex",role:"img",focusable:"false",viewBox:"0 -749.5 7270.3 999","aria-hidden":"true"},i1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},n1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.372ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.128ex",height:"2.398ex",role:"img",focusable:"false",viewBox:"0 -895.6 1824.4 1060","aria-hidden":"true"},l1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Q1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.041ex",height:"1.439ex",role:"img",focusable:"false",viewBox:"0 -442 460 636","aria-hidden":"true"},e1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},T1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.179ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 521 705","aria-hidden":"true"},h1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},p1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"61.13ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 27019.3 1000","aria-hidden":"true"},d1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},k1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.149ex"},xmlns:"http://www.w3.org/2000/svg",width:"40.559ex",height:"5.43ex",role:"img",focusable:"false",viewBox:"0 -1450 17927 2400","aria-hidden":"true"},r1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},o1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.172ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.383ex",height:"5.23ex",role:"img",focusable:"false",viewBox:"0 -1351.5 5031.3 2311.5","aria-hidden":"true"},m1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},g1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.054ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 466 453","aria-hidden":"true"},E1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},y1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.054ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 466 453","aria-hidden":"true"},c1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},u1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.054ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 466 453","aria-hidden":"true"},F1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},H1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"12.646ex",height:"2.072ex",role:"img",focusable:"false",viewBox:"0 -833.9 5589.7 915.9","aria-hidden":"true"},x1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},w1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-13.434ex"},xmlns:"http://www.w3.org/2000/svg",width:"50.453ex",height:"28ex",role:"img",focusable:"false",viewBox:"0 -6437.9 22300.2 12375.9","aria-hidden":"true"},L1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},C1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.69ex",height:"1.779ex",role:"img",focusable:"false",viewBox:"0 -775.2 3398.8 786.2","aria-hidden":"true"},f1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},D1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"22.583ex",height:"1.779ex",role:"img",focusable:"false",viewBox:"0 -775.2 9981.5 786.2","aria-hidden":"true"},M1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},b1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.738ex"},xmlns:"http://www.w3.org/2000/svg",width:"38.846ex",height:"4.774ex",role:"img",focusable:"false",viewBox:"0 -1342 17170 2110","aria-hidden":"true"},V1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},A1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.371ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -683 1048 705","aria-hidden":"true"},_1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},B1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.733ex"},xmlns:"http://www.w3.org/2000/svg",width:"13.037ex",height:"8.597ex",role:"img",focusable:"false",viewBox:"0 -2150 5762.2 3800","aria-hidden":"true"},Z1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},v1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.294ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 572 453","aria-hidden":"true"},j1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},R1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.149ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.612ex",height:"5.43ex",role:"img",focusable:"false",viewBox:"0 -1450 2480.6 2400","aria-hidden":"true"},q1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.665ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -683 1620 705","aria-hidden":"true"},O1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},P1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.733ex"},xmlns:"http://www.w3.org/2000/svg",width:"65.226ex",height:"8.597ex",role:"img",focusable:"false",viewBox:"0 -2150 28830.1 3800","aria-hidden":"true"},N1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},z1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.453ex"},xmlns:"http://www.w3.org/2000/svg",width:"22.476ex",height:"8.281ex",role:"img",focusable:"false",viewBox:"0 -2133.6 9934.4 3660","aria-hidden":"true"},I1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},X1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.464ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.819ex",height:"1.464ex",role:"img",focusable:"false",viewBox:"0 -442 804 647","aria-hidden":"true"},G1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},K1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.172ex"},xmlns:"http://www.w3.org/2000/svg",width:"15.791ex",height:"4.699ex",role:"img",focusable:"false",viewBox:"0 -1117 6979.5 2077","aria-hidden":"true"},J1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},U1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"16.34ex",height:"1.715ex",role:"img",focusable:"false",viewBox:"0 -676 7222.4 758","aria-hidden":"true"};function W1(Y1,a,$1,s2,a2,t2){return l(),n("div",null,[a[114]||(a[114]=i("",59)),s("p",null,[a[6]||(a[6]=t("首先将这个矩阵分别乘以 ")),s("mjx-container",V,[(l(),n("svg",A,a[0]||(a[0]=[i("",1)]))),a[1]||(a[1]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msub",null,[s("mi",null,"W"),s("mi",null,"Q")])])],-1))]),a[7]||(a[7]=t("、")),s("mjx-container",_,[(l(),n("svg",B,a[2]||(a[2]=[i("",1)]))),a[3]||(a[3]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msub",null,[s("mi",null,"W"),s("mi",null,"K")])])],-1))]),a[8]||(a[8]=t(" 和 ")),s("mjx-container",Z,[(l(),n("svg",v,a[4]||(a[4]=[i("",1)]))),a[5]||(a[5]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msub",null,[s("mi",null,"W"),s("mi",null,"V")])])],-1))]),a[9]||(a[9]=t(" 三个权重矩阵，得到 Q、K 和 V 矩阵："))]),s("mjx-container",j,[(l(),n("svg",R,a[10]||(a[10]=[i("",1)]))),a[11]||(a[11]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mi",null,"Q"),s("mo",null,"="),s("mi",null,"x"),s("msub",null,[s("mi",null,"W"),s("mi",null,"Q")]),s("mo",null,","),s("mstyle",{scriptlevel:"0"},[s("mspace",{width:"1em"})]),s("mi",null,"K"),s("mo",null,"="),s("mi",null,"x"),s("msub",null,[s("mi",null,"W"),s("mi",null,"K")]),s("mo",null,","),s("mstyle",{scriptlevel:"0"},[s("mspace",{width:"1em"})]),s("mi",null,"V"),s("mo",null,"="),s("mi",null,"x"),s("msub",null,[s("mi",null,"W"),s("mi",null,"V")])])],-1))]),a[115]||(a[115]=i("",3)),s("mjx-container",q,[(l(),n("svg",S,a[12]||(a[12]=[i("",1)]))),a[13]||(a[13]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mi",null,"A"),s("mi",null,"t"),s("mi",null,"t"),s("mi",null,"e"),s("mi",null,"n"),s("mi",null,"t"),s("mi",null,"i"),s("mi",null,"o"),s("mi",null,"n"),s("mo",{stretchy:"false"},"("),s("mi",null,"Q"),s("mo",null,","),s("mi",null,"K"),s("mo",null,","),s("mi",null,"V"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mi",null,"s"),s("mi",null,"o"),s("mi",null,"f"),s("mi",null,"t"),s("mi",null,"m"),s("mi",null,"a"),s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mfrac",null,[s("mrow",null,[s("mi",null,"Q"),s("msup",null,[s("mi",null,"K"),s("mi",null,"T")])]),s("msqrt",null,[s("msub",null,[s("mi",null,"d"),s("mi",null,"k")])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")]),s("mi",null,"V")])],-1))]),a[116]||(a[116]=i("",5)),s("mjx-container",O,[(l(),n("svg",P,a[14]||(a[14]=[i("",1)]))),a[15]||(a[15]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mi",null,"K"),s("mo",null,"="),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"1"),s("mo",null,","),s("mn",null,"1")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"1"),s("mo",null,","),s("mn",null,"2")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"1"),s("mo",null,","),s("mn",null,"3")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"2"),s("mo",null,","),s("mn",null,"1")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"2"),s("mo",null,","),s("mn",null,"2")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"2"),s("mo",null,","),s("mn",null,"3")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"3"),s("mo",null,","),s("mn",null,"1")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"3"),s("mo",null,","),s("mn",null,"2")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"3"),s("mo",null,","),s("mn",null,"3")])])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")]),s("mo",null,","),s("mstyle",{scriptlevel:"0"},[s("mspace",{width:"1em"})]),s("msup",null,[s("mi",null,"K"),s("mi",null,"T")]),s("mo",null,"="),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"1"),s("mo",null,","),s("mn",null,"1")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"2"),s("mo",null,","),s("mn",null,"1")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"3"),s("mo",null,","),s("mn",null,"1")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"1"),s("mo",null,","),s("mn",null,"2")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"2"),s("mo",null,","),s("mn",null,"2")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"3"),s("mo",null,","),s("mn",null,"2")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"1"),s("mo",null,","),s("mn",null,"3")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"2"),s("mo",null,","),s("mn",null,"3")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"a"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"3"),s("mo",null,","),s("mn",null,"3")])])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))]),a[117]||(a[117]=s("p",null,"本来矩阵是左边的行乘以右边的列，但右边转置了，就相当于左边的行乘以右边的行，变成了 Q 和 K 矩阵的每一行进行点积：",-1)),s("mjx-container",N,[(l(),n("svg",z,a[16]||(a[16]=[i("",1)]))),a[17]||(a[17]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mi",null,"q"),s("mo",null,"⋅"),s("mi",null,"k"),s("mo",null,"="),s("msub",null,[s("mi",null,"q"),s("mn",null,"0")]),s("msub",null,[s("mi",null,"k"),s("mn",null,"0")]),s("mo",null,"+"),s("msub",null,[s("mi",null,"q"),s("mn",null,"1")]),s("msub",null,[s("mi",null,"k"),s("mn",null,"1")]),s("mo",null,"+"),s("mo",null,"."),s("mo",null,"."),s("mo",null,"."),s("mo",null,"+"),s("msub",null,[s("mi",null,"q"),s("mi",null,"n")]),s("msub",null,[s("mi",null,"k"),s("mi",null,"n")])])],-1))]),a[118]||(a[118]=i("",4)),s("p",null,[a[28]||(a[28]=t("为什么有这样的几何意义？因为 ")),s("mjx-container",I,[(l(),n("svg",X,a[18]||(a[18]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D45E",d:"M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z",style:{"stroke-width":"3"}})])])],-1)]))),a[19]||(a[19]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"q")])],-1))]),a[29]||(a[29]=t(" 和 ")),s("mjx-container",G,[(l(),n("svg",K,a[20]||(a[20]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D458",d:"M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z",style:{"stroke-width":"3"}})])])],-1)]))),a[21]||(a[21]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"k")])],-1))]),a[30]||(a[30]=t(" 的点积等于 ")),s("mjx-container",J,[(l(),n("svg",U,a[22]||(a[22]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D45E",d:"M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z",style:{"stroke-width":"3"}})])])],-1)]))),a[23]||(a[23]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"q")])],-1))]),a[31]||(a[31]=t(" 在 ")),s("mjx-container",W,[(l(),n("svg",Y,a[24]||(a[24]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D458",d:"M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z",style:{"stroke-width":"3"}})])])],-1)]))),a[25]||(a[25]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"k")])],-1))]),a[32]||(a[32]=t(" 向量方向上的投影长度乘以 ")),s("mjx-container",$,[(l(),n("svg",s1,a[26]||(a[26]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D458",d:"M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z",style:{"stroke-width":"3"}})])])],-1)]))),a[27]||(a[27]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"k")])],-1))]),a[33]||(a[33]=t(" 的大小："))]),s("mjx-container",a1,[(l(),n("svg",t1,a[34]||(a[34]=[i("",1)]))),a[35]||(a[35]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mi",null,"q"),s("mo",null,"⋅"),s("mi",null,"k"),s("mo",null,"="),s("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),s("mi",null,"q"),s("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),s("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),s("mi",null,"k"),s("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mi",null,"θ")])],-1))]),a[119]||(a[119]=s("p",null,"cos 函数的特点是在 0 到 90 度之间是正数，90 到 180 度之间是负数，所以两个向量在相似方向时点积结果更大，反之则更小。如果两个向量之间夹角是 90 度，cos 计算结果为 0，说明两个向量不相关，也叫正交。",-1)),a[120]||(a[120]=s("p",null,[s("img",{src:k,alt:"cos 函数的值范围"})],-1)),s("p",null,[a[42]||(a[42]=t("Q 和 K 的转置相乘结果还要除以维度的开方 ")),s("mjx-container",i1,[(l(),n("svg",n1,a[36]||(a[36]=[i("",1)]))),a[37]||(a[37]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msqrt",null,[s("msub",null,[s("mi",null,"d"),s("mi",null,"k")])])])],-1))]),a[43]||(a[43]=t("，这是因为点乘后结果变大，需要缩小一下方差以避免影响 softmax 计算。这里我们不做公式推导，而是简单做个实验，使用 ")),a[44]||(a[44]=s("code",null,"torch.var",-1)),a[45]||(a[45]=t(" 来计算 ")),s("mjx-container",l1,[(l(),n("svg",Q1,a[38]||(a[38]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D45E",d:"M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z",style:{"stroke-width":"3"}})])])],-1)]))),a[39]||(a[39]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"q")])],-1))]),a[46]||(a[46]=t(" 和 ")),s("mjx-container",e1,[(l(),n("svg",T1,a[40]||(a[40]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D458",d:"M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z",style:{"stroke-width":"3"}})])])],-1)]))),a[41]||(a[41]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"k")])],-1))]),a[47]||(a[47]=t(" 的方差，结果是 1 点几："))]),a[121]||(a[121]=i("",25)),s("mjx-container",h1,[(l(),n("svg",p1,a[48]||(a[48]=[i("",1)]))),a[49]||(a[49]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mi",null,"M"),s("mi",null,"u"),s("mi",null,"l"),s("mi",null,"t"),s("mi",null,"i"),s("mi",null,"H"),s("mi",null,"e"),s("mi",null,"a"),s("mi",null,"d"),s("mo",{stretchy:"false"},"("),s("mi",null,"Q"),s("mo",null,","),s("mi",null,"K"),s("mo",null,","),s("mi",null,"V"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mi",null,"C"),s("mi",null,"o"),s("mi",null,"n"),s("mi",null,"c"),s("mi",null,"a"),s("mi",null,"t"),s("mo",{stretchy:"false"},"("),s("mi",null,"h"),s("mi",null,"e"),s("mi",null,"a"),s("msub",null,[s("mi",null,"d"),s("mn",null,"1")]),s("mo",null,","),s("mi",null,"h"),s("mi",null,"e"),s("mi",null,"a"),s("msub",null,[s("mi",null,"d"),s("mn",null,"2")]),s("mo",null,","),s("mo",null,"."),s("mo",null,"."),s("mo",null,"."),s("mo",null,","),s("mi",null,"h"),s("mi",null,"e"),s("mi",null,"a"),s("msub",null,[s("mi",null,"d"),s("mi",null,"h")]),s("mo",{stretchy:"false"},")"),s("mo",null,"⋅"),s("msub",null,[s("mi",null,"W"),s("mi",null,"O")])])],-1))]),a[122]||(a[122]=i("",13)),s("mjx-container",d1,[(l(),n("svg",k1,a[50]||(a[50]=[i("",1)]))),a[51]||(a[51]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mi",null,"f"),s("mo",{stretchy:"false"},"("),s("mi",null,"x"),s("mo",null,","),s("mi",null,"m"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"m"),s("mn",null,"0")]),s("mo",{stretchy:"false"},")")]),s("mtd",null,[s("mo",null,"−"),s("mi",null,"sin"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"m"),s("mn",null,"0")]),s("mo",{stretchy:"false"},")")])]),s("mtr",null,[s("mtd",null,[s("mi",null,"sin"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"m"),s("mn",null,"0")]),s("mo",{stretchy:"false"},")")]),s("mtd",null,[s("mi",null,"cos"),s("mo",{"data-mjx-texclass":"NONE"},"⁡"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"m"),s("mn",null,"0")]),s("mo",{stretchy:"false"},")")])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")]),s("mo",null,"⋅"),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"x"),s("mn",null,"1")])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"x"),s("mn",null,"2")])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))]),a[123]||(a[123]=i("",9)),s("mjx-container",r1,[(l(),n("svg",o1,a[52]||(a[52]=[i("",1)]))),a[53]||(a[53]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("msub",null,[s("mi",null,"y"),s("mi",null,"i")]),s("mo",null,"="),s("mfrac",null,[s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("msub",null,[s("mi",null,"x"),s("mi",null,"i")])])]),s("mrow",null,[s("mo",{"data-mjx-texclass":"OP"},"∑"),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("msub",null,[s("mi",null,"x"),s("mi",null,"j")])])])])])])],-1))]),a[124]||(a[124]=i("",2)),s("p",null,[a[56]||(a[56]=t("你可能会好奇，为什么要这样计算。如果要将一组数字转成 0 到 1 之间，有个简单的方法是先求和，然后每个数除以这个总和，但这么做有两个问题：一是当有些数字是负数时，不能用这种方式；二是当数值较多时，求和很容易超出表示范围导致溢出，因此使用 ")),s("mjx-container",m1,[(l(),n("svg",g1,a[54]||(a[54]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D452",d:"M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z",style:{"stroke-width":"3"}})])])],-1)]))),a[55]||(a[55]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"e")])],-1))]),a[57]||(a[57]=t(" 的指数。"))]),s("p",null,[a[64]||(a[64]=t("但使用 ")),s("mjx-container",E1,[(l(),n("svg",y1,a[58]||(a[58]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D452",d:"M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z",style:{"stroke-width":"3"}})])])],-1)]))),a[59]||(a[59]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"e")])],-1))]),a[65]||(a[65]=t(" 的指数也有个问题，那就是数值较大时容易溢出。FP16 能表示的最大值是 65504，而 ")),s("mjx-container",c1,[(l(),n("svg",u1,a[60]||(a[60]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D452",d:"M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z",style:{"stroke-width":"3"}})])])],-1)]))),a[61]||(a[61]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"e")])],-1))]),a[66]||(a[66]=t(" 的指数只要大于 11 就会超过这个值。例如，")),s("mjx-container",F1,[(l(),n("svg",H1,a[62]||(a[62]=[i("",1)]))),a[63]||(a[63]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"12")])]),s("mo",null,"="),s("mn",null,"162754")])],-1))]),a[67]||(a[67]=t("，溢出之后计算结果就是错误的。因此，出现了改进算法，先找出数字中的最大值，然后所有数字减去这个最大值，使得所有数字都小于等于 0，这样就不会出现最大值溢出。用 Python 来理解："))]),a[125]||(a[125]=i("",4)),s("mjx-container",x1,[(l(),n("svg",w1,a[68]||(a[68]=[i("",1)]))),a[69]||(a[69]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mtable",{columnalign:"left",columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd")]),s("mtr",null,[s("mtd",null,[s("mi",null,"t"),s("mi",null,"o"),s("mi",null,"t"),s("mi",null,"a"),s("msub",null,[s("mi",null,"l"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"N")])]),s("mo",null,"="),s("munderover",null,[s("mo",{"data-mjx-texclass":"OP"},"∑"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"j")]),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])]),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("msub",null,[s("mi",null,"x"),s("mi",null,"j")]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])])])])])]),s("mtr",null,[s("mtd")]),s("mtr",null,[s("mtd",null,[s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mo",null,"="),s("munderover",null,[s("mo",{"data-mjx-texclass":"OP"},"∑"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"j")]),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mo",null,"−"),s("mn",null,"1")])]),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("msub",null,[s("mi",null,"x"),s("mi",null,"j")]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])])])]),s("mo",null,"+"),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])])])])])]),s("mtr",null,[s("mtd")]),s("mtr",null,[s("mtd",null,[s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mo",null,"="),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("munderover",null,[s("mo",{"data-mjx-texclass":"OP"},"∑"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"j")]),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mo",null,"−"),s("mn",null,"1")])]),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("msub",null,[s("mi",null,"x"),s("mi",null,"j")]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mo",null,"−"),s("mn",null,"1")])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")]),s("mo",null,"∗"),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mo",null,"−"),s("mn",null,"1")])]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])])])]),s("mo",null,"+"),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])])])])])]),s("mtr",null,[s("mtd")]),s("mtr",null,[s("mtd",null,[s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mtext",null," "),s("mo",null,"="),s("mi",null,"t"),s("mi",null,"o"),s("mi",null,"t"),s("mi",null,"a"),s("msub",null,[s("mi",null,"l"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"N"),s("mo",null,"−"),s("mn",null,"1")])]),s("mo",null,"∗"),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mo",null,"−"),s("mn",null,"1")])]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])])])]),s("mo",null,"+"),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])])])])])])])])],-1))]),s("p",null,[a[74]||(a[74]=t("关键在于第三步的拆分，")),s("mjx-container",L1,[(l(),n("svg",C1,a[70]||(a[70]=[i("",1)]))),a[71]||(a[71]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("msub",null,[s("mi",null,"x"),s("mi",null,"j")]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])])])])])],-1))]),a[75]||(a[75]=t(" 可以表示为 ")),s("mjx-container",f1,[(l(),n("svg",D1,a[72]||(a[72]=[i("",1)]))),a[73]||(a[73]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("msub",null,[s("mi",null,"x"),s("mi",null,"j")]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mo",null,"−"),s("mn",null,"1")])])])]),s("mo",null,"∗"),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mo",null,"−"),s("mn",null,"1")])]),s("mo",null,"−"),s("mi",null,"m"),s("mi",null,"a"),s("msub",null,[s("mi",null,"x"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i")])])])])])],-1))]),a[76]||(a[76]=t("，而前一部分的求和正好是上一个 total 的结果，因此只需一次循环就能计算 total，从而提升了性能。"))]),a[126]||(a[126]=i("",17)),s("mjx-container",M1,[(l(),n("svg",b1,a[77]||(a[77]=[i("",1)]))),a[78]||(a[78]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mtext",null,"SiLU"),s("mo",{stretchy:"false"},"("),s("mi",null,"x"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mi",null,"x"),s("mo",null,"⋅"),s("mtext",null,"sigmoid"),s("mo",{stretchy:"false"},"("),s("mi",null,"x"),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("mi",null,"x"),s("mo",null,"⋅"),s("mfrac",null,[s("mn",null,"1"),s("mrow",null,[s("mn",null,"1"),s("mo",null,"+"),s("msup",null,[s("mi",null,"e"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"−"),s("mi",null,"x")])])])])])],-1))]),a[127]||(a[127]=i("",6)),s("p",null,[a[81]||(a[81]=t("矩阵乘法是大模型中最重要的计算，但这样做的意义是什么？假设一个矩阵 ")),s("mjx-container",V1,[(l(),n("svg",A1,a[79]||(a[79]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D44A",d:"M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z",style:{"stroke-width":"3"}})])])],-1)]))),a[80]||(a[80]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"W")])],-1))]),a[82]||(a[82]=t("："))]),s("mjx-container",_1,[(l(),n("svg",B1,a[83]||(a[83]=[i("",1)]))),a[84]||(a[84]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"11")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"12")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"21")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"22")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"31")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"32")])])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))]),s("p",null,[a[87]||(a[87]=t("输入是向量 ")),s("mjx-container",Z1,[(l(),n("svg",v1,a[85]||(a[85]=[s("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[s("g",{"data-mml-node":"math"},[s("g",{"data-mml-node":"mi"},[s("path",{"data-c":"1D465",d:"M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z",style:{"stroke-width":"3"}})])])],-1)]))),a[86]||(a[86]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"x")])],-1))]),a[88]||(a[88]=t("，比如："))]),s("mjx-container",j1,[(l(),n("svg",R1,a[89]||(a[89]=[i("",1)]))),a[90]||(a[90]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"x"),s("mn",null,"1")])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"x"),s("mn",null,"2")])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))]),s("p",null,[a[93]||(a[93]=t("矩阵乘以向量 ")),s("mjx-container",q1,[(l(),n("svg",S1,a[91]||(a[91]=[i("",1)]))),a[92]||(a[92]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mi",null,"W"),s("mi",null,"x")])],-1))]),a[94]||(a[94]=t("，拆解一下计算过程，就是："))]),s("mjx-container",O1,[(l(),n("svg",P1,a[95]||(a[95]=[i("",1)]))),a[96]||(a[96]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"11")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"12")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"21")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"22")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"31")])])]),s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"32")])])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")]),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"x"),s("mn",null,"1")])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"x"),s("mn",null,"2")])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")]),s("mo",null,"="),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"11")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"21")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"31")])])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")]),s("msub",null,[s("mi",null,"x"),s("mn",null,"1")]),s("mo",null,"+"),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"12")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"22")])])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"32")])])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")]),s("msub",null,[s("mi",null,"x"),s("mn",null,"2")]),s("mo",null,"="),s("mrow",{"data-mjx-texclass":"INNER"},[s("mo",{"data-mjx-texclass":"OPEN"},"("),s("mtable",{columnspacing:"1em",rowspacing:"4pt"},[s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"11")])]),s("msub",null,[s("mi",null,"x"),s("mn",null,"1")]),s("mo",null,"+"),s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"12")])]),s("msub",null,[s("mi",null,"x"),s("mn",null,"2")])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"21")])]),s("msub",null,[s("mi",null,"x"),s("mn",null,"1")]),s("mo",null,"+"),s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"22")])]),s("msub",null,[s("mi",null,"x"),s("mn",null,"2")])])]),s("mtr",null,[s("mtd",null,[s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"31")])]),s("msub",null,[s("mi",null,"x"),s("mn",null,"1")]),s("mo",null,"+"),s("msub",null,[s("mi",null,"w"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mn",null,"32")])]),s("msub",null,[s("mi",null,"x"),s("mn",null,"2")])])])]),s("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))]),a[128]||(a[128]=s("p",null,"这个计算过程可以认为是对输入的每个值做了调整，将输入映射到另一个空间。这个过程可以看成是一种通用近似函数，实现对数值的任意转换。",-1)),a[129]||(a[129]=s("h3",{id:"归一化",tabindex:"-1"},[t("归一化 "),s("a",{class:"header-anchor",href:"#归一化","aria-label":'Permalink to "归一化"'},"​")],-1)),a[130]||(a[130]=s("p",null,"LlamaRMSNorm 是一种归一化层，归一化是将不同数值转换为同一区间（比如 -1 和 1 之间），以避免某些数值过大导致的偏差。尤其在大模型中，每次经过 Attention 计算后，数值可能会变化。例如，下面的示例展示了这一点：",-1)),a[131]||(a[131]=s("p",null,[s("img",{src:y,alt:"矩阵相乘后将改变隐藏层的均值"})],-1)),a[132]||(a[132]=s("p",null,"左侧每个 token 的隐藏层数值的均值是 0，经过一次矩阵乘法后分别变成了 0.5 和 0.1。如果再经过几层计算，数值差异可能会越来越大，这将对后续计算造成影响。因此，需要进行归一化，使它们的分布一致，从而使后续计算更稳定。",-1)),a[133]||(a[133]=s("p",null,[t("主流大模型如 Llama 通常使用的归一化方法是 "),s("a",{href:"http://arxiv.org/abs/1910.07467",target:"_blank",rel:"noreferrer"},"^RMSNorm"),t("，其中的 RMS 是 Root Mean Square（均方根）的缩写。其计算方法是每个数的平方和除以数量，再开方，公式如下：")],-1)),s("mjx-container",N1,[(l(),n("svg",z1,a[97]||(a[97]=[i("",1)]))),a[98]||(a[98]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"R"),s("mi",null,"M"),s("mi",null,"S")]),s("mo",{stretchy:"false"},"("),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"a")]),s("mo",{stretchy:"false"},")"),s("mo",null,"="),s("msqrt",null,[s("mfrac",null,[s("mn",null,"1"),s("mi",null,"n")]),s("munderover",null,[s("mo",{"data-mjx-texclass":"OP"},"∑"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"i"),s("mo",null,"="),s("mn",null,"1")]),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",null,"n")])]),s("msubsup",null,[s("mi",null,"a"),s("mi",null,"i"),s("mn",null,"2")])])])],-1))]),a[134]||(a[134]=i("",2)),s("p",null,[a[101]||(a[101]=t("RMSNorm 的实现是将每个值除以这个均方根，再乘以一个可学习的权重，比如下面的 ")),s("mjx-container",I1,[(l(),n("svg",X1,a[99]||(a[99]=[i("",1)]))),a[100]||(a[100]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("msub",null,[s("mi",null,"g"),s("mi",null,"i")])])],-1))]),a[102]||(a[102]=t("："))]),s("mjx-container",G1,[(l(),n("svg",K1,a[103]||(a[103]=[i("",1)]))),a[104]||(a[104]=s("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("msub",null,[s("mrow",{"data-mjx-texclass":"ORD"},[s("mover",null,[s("mi",null,"a"),s("mo",{stretchy:"false"},"¯")])]),s("mi",null,"i")]),s("mo",null,"="),s("mfrac",null,[s("msub",null,[s("mi",null,"a"),s("mi",null,"i")]),s("mrow",null,[s("mtext",null,"RMS"),s("mo",{stretchy:"false"},"("),s("mrow",{"data-mjx-texclass":"ORD"},[s("mi",{mathvariant:"bold"},"a")]),s("mo",{stretchy:"false"},")")])]),s("msub",null,[s("mi",null,"g"),s("mi",null,"i")])])],-1))]),a[135]||(a[135]=i("",84)),s("ul",null,[a[110]||(a[110]=s("li",null,[s("strong",null,"图像切分"),t("：将图像分割成一个个小块，比如 16x16 像素的小块，其中每个像素由 RGB 3 个数字表示，因此张量维度分别是 [16, 16, 3]。")],-1)),s("li",null,[a[107]||(a[107]=s("strong",null,"维度展平",-1)),a[108]||(a[108]=t("：将每个小块映射成一个 token，每个 token 的维度是 ")),s("mjx-container",J1,[(l(),n("svg",U1,a[105]||(a[105]=[i("",1)]))),a[106]||(a[106]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mn",null,"16"),s("mo",null,"∗"),s("mn",null,"16"),s("mo",null,"∗"),s("mn",null,"3"),s("mo",null,"="),s("mn",null,"768")])],-1))]),a[109]||(a[109]=t("，这里可以使用卷积操作。"))]),a[111]||(a[111]=s("li",null,[s("strong",null,"添加特殊 token"),t("：在 token 序列的最前面加一个特殊 "),s("code",null,"[CLS]"),t(" token 用于分类任务，这一做法仿照了 BERT 中的设计，用这个特殊 token 来作为整个图像的特征输出。")],-1)),a[112]||(a[112]=s("li",null,[s("strong",null,"添加位置信息"),t("：给这些 token 加上位置信息，这里的作用和文本一样，让模型区分不同位置上的图像 token。")],-1)),a[113]||(a[113]=s("li",null,[s("strong",null,"输入到 Transformer 编码层"),t("：将处理后的 token 输入到 Transformer 编码层中进行编码，通过后续训练来学习图像特征。")],-1))]),a[136]||(a[136]=i("",36))])}const l2=Q(b,[["render",W1]]);export{n2 as __pageData,l2 as default};
